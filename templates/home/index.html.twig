{% extends 'base.html.twig' %}

{% block title %}{% endblock %}

{% block body %}
    <article>
        <div id="carouselExampleControls" class="carousel slide p-4" data-ride="carousel">
            <div class="carousel-inner">
                {% for category in Category %}
                    {% if loop.first %}
                        <div class="carousel-item active text-center">
                            <a href="#{{ category.Name }}">{{ category.Name }}</a>
                        </div>
                    {% else %}
                        <div class="carousel-item text-center">
                            <a href="#{{ category.Name }}">{{ category.Name }}</a>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            <a class="carousel-control-prev text-dark" href="#carouselExampleControls" role="button" data-slide="prev">
                <span class="" aria-hidden="true"><i class="fas fa-arrow-left"></i></span>
                <span class="sr-only">{% trans %}Previous{% endtrans %}</span>
            </a>
            <a class="carousel-control-next text-dark" href="#carouselExampleControls" role="button" data-slide="next">
                <span class="" aria-hidden="true"><i class="fas fa-arrow-right"></i></span>
                <span class="sr-only">{% trans %}Next{% endtrans %}</span>
            </a>
        </div>
    </article>
    <article>
        {% for category in Category %}
            {% if category.projects|length > 0 %}
                <hr>
                <h3 id="{{ category }}" class="text-center">{{ category }}</h3>
                <hr>
                <article class="projectArticle">
                {% for project in Projects %}
                    {% if project.categories.contains(category) %}
                        <div class="projectContainer lovedProjects d-inline-block">
                            <div class="card d-block" style="width: 18rem;">
                                <img class="card-img-top" src="{{ project.miniature }}"
                                     alt="miniature of {{ project.title }}"
                                     style="height: 12em">
                                <div class="card-body">
                                    <div class="progress">
                                        <div class="progress-bar bg-warning" role="progressbar"
                                             style="width: {{ (project.goal - project.rest) / project.goal * 100 }}%"
                                             aria-valuenow="{{ (project.goal - project.rest) / project.goal * 100 }}"
                                             aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h5 class="card-title">{{ project.title }}</h5>
                                    <p class="card-text">{{ project.goal - project.rest }} / {{ project.goal }}â‚¬</p>
                                    <div class="d-inline-flex">
                                        {% if is_granted('ROLE_USER') %}
                                            <a href="{{ path('project_show', {'id': project.id}) }}"
                                               class="btn btn-primary">{% trans %}Read
                                                    More{% endtrans %}</a>
                                            <div class="d-inline-flex">
                                                {% if app.user.isProjectLiked(project) %}
                                                    <i data-id="{{ project.id }}" data-up="1"
                                                       data-url="{{ path('project_unlike', {'id': project.id}) }}"
                                                       class="unup fas fa-thumbs-up  text-primary"></i>
                                                {% else %}
                                                    <i data-id="{{ project.id }}" data-up="1"
                                                       data-url="{{ path('project_like', {'id': project.id}) }}"
                                                       class="up fas fa-thumbs-up"></i>
                                                {% endif %}
                                                <p class="upNB">{{ project.likep.count }}</p>
                                            </div>

                                            <div class="d-inline-flex">
                                                {% if app.user.isProjectDisliked(project) %}
                                                    <i data-id="{{ project.id }}" data-up="0"
                                                       data-url="{{ path('project_undislike', {'id': project.id}) }}"
                                                       class="undown fas fa-thumbs-down text-danger"></i>
                                                {% else %}
                                                    <i data-id="{{ project.id }}" data-up="0"
                                                       data-url="{{ path('project_dislike', {'id': project.id}) }}"
                                                       class="down fas fa-thumbs-down"></i>
                                                {% endif %}

                                                <p class="downNB">{{ project.down }}</p>
                                            </div>
                                            {% if app.user.isProjectSubscribe(project) %}
                                                <i data-up="2" class="unsub fas fa-bookmark text-info"
                                                   data-url="{{ path('project_unsub', {'id': project.id}) }}"></i>
                                            {% else %}
                                                <i data-up="2" class="sub fas fa-bookmark"
                                                   data-url="{{ path('project_sub', {'id': project.id}) }}"></i>
                                                <!-- TODO - Condition a faire pour changer image en fonction de la cagnotte (quand on l'aura) !-->
                                            {% endif %}
                                        {% else %}
                                            <a href="{{ path('project_show', {'id': project.id}) }}"
                                               class="btn btn-primary">Read
                                                More</a>
                                            <div class="d-inline-flex">
                                                <a onclick="alert('{% trans %}You need to be authenticated for make this action{% endtrans %}')"><i
                                                            class="fas fa-thumbs-up"
                                                            onclick="alert('{% trans %}You need to be authenticated for make this action{% endtrans %}')"></i></a>
                                                <p>{{ project.up }}</p>
                                            </div>
                                            <div class="d-inline-flex">
                                                <a onclick="alert('{% trans %}You need to be authenticated for make this action{% endtrans %}')"><i
                                                            class="fas fa-thumbs-down"></i></a>
                                                <p onclick="alert('{% trans %}You need to be authenticated for make this action{% endtrans %}')">{{ project.down }}</p>
                                            </div>
                                            <a onclick="alert('{% trans %}You need to be authenticated for make this action{% endtrans %}')"><i
                                                        class="fas fa-bookmark"></i></a>
                                        {% endif %}
                                    </div>
                                    {% if (project.goal - project.rest) / project.goal * 100 >= 100 %}
                                        <img src="{{ asset('Resources/Logo.svg') }}" alt="pingouin" style="width: 50px">
                                    {% elseif (project.goal - project.rest) / project.goal * 100 < 50 %}
                                        <img src="{{ asset('Resources/bebe_pingouin.svg') }}" alt="pingouin"
                                             style="width: 50px">
                                    {% elseif (project.goal - project.rest) / project.goal * 100 >= 50 %}
                                        <img src="{{ asset('Resources/ado_pingouin.svg') }}" alt="pingouin"
                                             style="width: 50px">
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    </article>
                {% endfor %}
            {% endif %}
        {% endfor %}
    </article>
{% endblock %}
